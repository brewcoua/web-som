var O=["a[href]:not(:has(img))","a[href] img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],k=0.6,G=0.1;async function L(w){return(await Promise.all(w.map(async(M)=>{if(M.offsetWidth===0&&M.offsetHeight===0)return null;const j=M.id==="company-name",Q=window.getComputedStyle(M);if(Q.display==="none"||Q.visibility==="hidden"||Q.pointerEvents==="none")return null;let q=M.parentElement,U=!0;while(q!==null){const H=window.getComputedStyle(q);if(H.display==="none"||H.visibility==="hidden"||H.pointerEvents==="none"){U=!1;break}q=q.parentElement}if(!U)return null;const y=M.getBoundingClientRect();if(y.top>=window.innerHeight||y.bottom<=0||y.left>=window.innerWidth||y.right<=0)return null;if(!await T(M))return null;return M}))).filter((M)=>M!==null)}async function T(w){return new Promise(($)=>{const M=new IntersectionObserver(async(j)=>{const Q=j[0];if(M.disconnect(),Q.intersectionRatio<k){$(!1);return}const q=w.getBoundingClientRect();if(q.width<=1||q.height<=1){$(!1);return}if(q.width>=window.innerWidth*0.8||q.height>=window.innerHeight*0.8){$(!1);return}const U=await S(w,q);$(U>=k)});M.observe(w)})}async function S(w,$){const M=document.createElement("canvas"),j=M.getContext("2d",{willReadFrequently:!0});if(!j)throw new Error("Could not get 2D context");const Q=parseInt(window.getComputedStyle(w).zIndex||"0",10);M.width=$.width,M.height=$.height,j.fillStyle="black",j.fillRect(0,0,M.width,M.height);const q={top:Math.max(0,$.top),left:Math.max(0,$.left),bottom:Math.min(window.innerHeight,$.bottom),right:Math.min(window.innerWidth,$.right)},U={width:q.right-q.left,height:q.bottom-q.top},y=()=>{const K=j.getImageData(q.left-$.left,q.top-$.top,U.width,U.height).data;let D=0;for(let F=0;F<K.length;F+=4)if(K[F]>0)D++;return D};A(w,j,$,$,"white");const J=y(),H=await Promise.all(Array.from({length:Math.ceil(1/G)}).map(async(K,D)=>{const F=document.elementsFromPoint($.left+$.width*G*D,$.top+$.height*G*D);if(!F.includes(w))return[];const Z=F.indexOf(w);return F.slice(0,Z)})),X=Array.from(new Set(H.flat().filter((K)=>K!==w)));let W=[];for(let K of X){if(parseInt(window.getComputedStyle(K).zIndex||"0",10)<Q)continue;if(K.contains(w)||w.contains(K))continue;W.push(K)}W=W.filter((K)=>{for(let D of W)if(K!==D&&D.contains(K))return!1;return!0}),await Promise.all(W.map(async(K)=>{const D=K.getBoundingClientRect();A(K,j,D,$,"black")}));const Y=y();if(M.remove(),J===0||Y===0)return 0;return Y/J}var A=function(w,$,M,j,Q="black"){const q=new Path2D,U=window.getComputedStyle(w),y=U.borderRadius?.split(" ").map((X)=>parseFloat(X)),J=U.clipPath,H={top:Math.max(M.top-j.top,0),bottom:Math.min(M.bottom-j.top,j.height),left:Math.max(M.left-j.left,0),right:Math.min(M.right-j.left,j.width),width:Math.min(M.right-j.left,j.width)-Math.max(M.left-j.left,0),height:Math.min(M.bottom-j.top,j.height)-Math.max(M.top-j.top,0)};if(y){if(y.length===1)y[1]=y[0];if(y.length===2)y[2]=y[0];if(y.length===3)y[3]=y[1];q.moveTo(H.left+y[0],H.top),q.arcTo(H.right,H.top,H.right,H.bottom,y[1]),q.arcTo(H.right,H.bottom,H.left,H.bottom,y[2]),q.arcTo(H.left,H.bottom,H.left,H.top,y[3]),q.arcTo(H.left,H.top,H.right,H.top,y[0])}else q.rect(H.left,H.top,H.width,H.height);if(J&&J!=="none"){const X=new Path2D(J);q.addPath(X)}$.fillStyle=Q,$.fill(q)};async function N(w){return(await Promise.all(w.map(async(M)=>{let j=M.parentElement;while(j!==null){if(w.includes(j))return null;j=j.parentElement}return M}))).filter((M)=>M!==null)}async function B(){const w=document.querySelectorAll(O.join(",")),$=document.querySelectorAll("*"),M=[];for(let q=0;q<$.length;q++)if(window.getComputedStyle($[q]).cursor==="pointer")M.push($[q]);const j=Array.from(w).concat(M).filter((q,U,y)=>y.indexOf(q)===U).filter((q)=>!q.closest("svg")),Q=await L(j);return await N(Q)}function C(w){const $=[],M=[],j=[],Q=()=>Math.floor(Math.random()*256);for(let q=0;q<w.length;q++){const y=w[q].getBoundingClientRect(),J=document.createElement("div");J.style.left=`${y.left}px`,J.style.top=`${y.top}px`,J.style.width=`${y.width}px`,J.style.height=`${y.height}px`,J.classList.add("SoM");const H=[Q(),Q(),Q()];J.style.backgroundColor=`rgba(${H.join(",")}, 0.5)`,document.body.appendChild(J),M.push({top:y.top,bottom:y.bottom,left:y.left,right:y.right,width:y.width,height:y.height,color:H}),j.push(J)}for(let q=0;q<w.length;q++){const U=w[q],y=M[q],J=document.createElement("label");J.textContent=`${q}`,J.style.color=_(y.color),J.style.backgroundColor=`rgba(${y.color.join(",")}, 0.7)`,j[q].appendChild(J);const H=J.getBoundingClientRect(),X=10,W=[];for(let D=0;D<=X;D++)W.push({top:y.top-H.height,left:y.left+y.width/X*D-H.width/2}),W.push({top:y.bottom,left:y.left+y.width/X*D-H.width/2}),W.push({top:y.top+y.height/X*D-H.height/2,left:y.left-H.width}),W.push({top:y.top+y.height/X*D-H.height/2,left:y.right});const Y=W.map((D)=>{let F=0;if(D.top<0||D.top+H.height>window.innerHeight||D.left<0||D.left+H.width>window.innerWidth)F+=Infinity;else $.concat(M).forEach((Z)=>{const z=Math.max(0,Math.min(D.left+H.width,Z.left+Z.width)-Math.max(D.left,Z.left)),E=Math.max(0,Math.min(D.top+H.height,Z.top+Z.height)-Math.max(D.top,Z.top));F+=z*E});return F}),K=W[Y.indexOf(Math.min(...Y))];J.style.top=`${K.top-y.top}px`,J.style.left=`${K.left-y.left}px`,$.push({top:K.top,left:K.left,right:K.left+H.width,bottom:K.top+H.height,width:H.width,height:H.height}),U.setAttribute("data-SoM",`${q}`)}}var _=function(w){const[$,M,j]=w.map((q)=>q/255);return 0.299*$+0.587*M+0.114*j>0.5?"black":"white"};class V{async display(){this.clear();const w=await B();C(w)}clear(){document.querySelectorAll(".SoM").forEach((w)=>{w.remove()}),document.querySelectorAll("[data-som]").forEach((w)=>{w.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="block")}resolve(w){return document.querySelector(`[data-som="${w}"]`)}}window.SoM=new V;
