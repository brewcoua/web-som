var _=["a:not(:has(img))","a img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],A=['input[type="text"]','input[type="password"]','input[type="email"]','input[type="tel"]','input[type="number"]','input[type="search"]','input[type="url"]','input[type="date"]','input[type="time"]','input[type="datetime-local"]','input[type="month"]','input[type="week"]','input[type="color"]',"textarea",'[contenteditable="true"]'],N=0.6,Y=0.2;class D{}class S extends D{constructor(){super(...arguments)}async apply(K){return(await Promise.all(K.map(async(M)=>{if(M.offsetWidth===0&&M.offsetHeight===0)return null;const J=window.getComputedStyle(M);if(J.display==="none"||J.visibility==="hidden"||J.pointerEvents==="none")return null;let j=M.parentElement,Q=!0;while(j!==null){const U=window.getComputedStyle(j);if(U.display==="none"||U.visibility==="hidden"||U.pointerEvents==="none"){Q=!1;break}j=j.parentElement}if(!Q)return null;if(!await this.isElementVisible(M))return null;return M}))).filter((M)=>M!==null)}async isElementVisible(K){return new Promise(($)=>{const M=new IntersectionObserver(async(J)=>{const j=J[0];if(M.disconnect(),j.intersectionRatio<N){$(!1);return}const Q=K.getBoundingClientRect();if(Q.width<=1||Q.height<=1){$(!1);return}if(Q.width>=window.innerWidth*0.8||Q.height>=window.innerHeight*0.8){$(!1);return}const X=await this.getVisibilityRatio(K,Q);$(X>=N)});M.observe(K)})}async getVisibilityRatio(K,$){const M=document.createElement("canvas"),J=M.getContext("2d",{willReadFrequently:!0});if(!J)throw new Error("Could not get 2D context");const j=parseInt(window.getComputedStyle(K).zIndex||"0",10);M.width=$.width,M.height=$.height,J.fillStyle="black",J.fillRect(0,0,M.width,M.height);const Q={top:Math.max(0,$.top),left:Math.max(0,$.left),bottom:Math.min(window.innerHeight,$.bottom),right:Math.min(window.innerWidth,$.right),width:$.width,height:$.height};Q.width=Q.right-Q.left,Q.height=Q.bottom-Q.top,this.drawElement(K,J,$,$,"white");const X=this.countVisiblePixels(J,{top:Q.top-$.top,left:Q.left-$.left,width:M.width,height:M.height}),U=await this.getIntersectingElements(K);await Promise.all(U.map(async(W)=>{const z=W.getBoundingClientRect();this.drawElement(W,J,z,$,"black")}));const q=this.countVisiblePixels(J,{top:Q.top-$.top,left:Q.left-$.left,width:Q.width,height:Q.height});if(M.remove(),X===0)return 0;return q/X}async getIntersectingElements(K){const $=parseInt(window.getComputedStyle(K).zIndex||"0",10),M=K.getBoundingClientRect(),J=await Promise.all(Array.from({length:Math.ceil(1/Y)}).map(async(X,U)=>{return Array.from({length:Math.ceil(1/Y)}).map((q,W)=>{const z=document.elementsFromPoint(M.left+M.width*Y*U,M.top+M.height*Y*W);if(!z.includes(K))return[];const V=z.indexOf(K);return z.slice(0,V)})})),j=Array.from(new Set(J.flat(2).filter((X)=>X!==K)));let Q=[];for(let X of j){if(parseInt(window.getComputedStyle(X).zIndex||"0",10)<$)continue;if(X.contains(K)||K.contains(X))continue;Q.push(X)}return Q=Q.filter((X)=>{for(let U of Q)if(X!==U&&U.contains(X))return!1;return!0}),Q}countVisiblePixels(K,$){const M=K.getImageData($.left,$.top,$.width,$.height).data;let J=0;for(let j=0;j<M.length;j+=4)if(M[j]>0)J++;return J}drawElement(K,$,M,J,j="black"){const Q=window.getComputedStyle(K),X=Q.borderRadius?.split(" ").map((W)=>parseFloat(W)),U=Q.clipPath,q={top:M.top-J.top,bottom:M.bottom-J.top,left:M.left-J.left,right:M.right-J.left,width:M.width,height:M.height};if(q.width=q.right-q.left,q.height=q.bottom-q.top,$.fillStyle=j,U&&U!=="none")U.split(/,| /).forEach((z)=>{const V=z.trim().match(/^([a-z]+)\((.*)\)$/);if(!V)return;switch(V[0]){case"polygon":const F=this.pathFromPolygon(z,M);$.fill(F);break;default:console.log("Unknown clip path kind: "+V)}});else if(X){const W=new Path2D;if(X.length===1)X[1]=X[0];if(X.length===2)X[2]=X[0];if(X.length===3)X[3]=X[1];W.moveTo(q.left+X[0],q.top),W.arcTo(q.right,q.top,q.right,q.bottom,X[1]),W.arcTo(q.right,q.bottom,q.left,q.bottom,X[2]),W.arcTo(q.left,q.bottom,q.left,q.top,X[3]),W.arcTo(q.left,q.top,q.right,q.top,X[0]),W.closePath(),$.fill(W)}else $.fillRect(q.left,q.top,q.width,q.height)}pathFromPolygon(K,$){if(!K||!K.match(/^polygon\((.*)\)$/))throw new Error("Invalid polygon format: "+K);const M=new Path2D,J=K.match(/\d+(\.\d+)?%/g);if(J&&J.length>=2){const j=parseFloat(J[0]),Q=parseFloat(J[1]);M.moveTo(j*$.width/100,Q*$.height/100);for(let X=2;X<J.length;X+=2){const U=parseFloat(J[X]),q=parseFloat(J[X+1]);M.lineTo(U*$.width/100,q*$.height/100)}M.closePath()}return M}}var k=S;var L=0.9,y=3,v=["a","button","input","select","textarea"];class P extends D{constructor(){super(...arguments)}async apply(K){const{top:$,others:M}=this.getTopLevelElements(K);return(await Promise.all($.map(async(j)=>this.compareTopWithChildren(j,M)))).flat()}async compareTopWithChildren(K,$){if(v.some((X)=>K.matches(X)))return[K];const M=this.getBranches(K,$),J=K.getBoundingClientRect();if(M.length<=1)return[K];const Q=(await Promise.all(M.map(async(X)=>{const U=X.top.getBoundingClientRect();if(U.width/J.width<L&&U.height/J.height<L)return[];if(X.children.length===0)return[X.top];return await this.compareTopWithChildren(X.top,X.children)}))).flat();if(Q.length>y)return Q;return[K,...Q]}getBranches(K,$){const M=this.getFirstHitChildren(K,$);return M.map((J)=>{const j=$.filter((Q)=>!M.includes(Q)&&J.contains(Q));return{top:J,children:j}})}getFirstHitChildren(K,$){const M=K.querySelectorAll(":scope > *"),J=Array.from(M).filter((j)=>$.includes(j));if(J.length>0)return J;return Array.from(M).flatMap((j)=>this.getFirstHitChildren(j,$))}getTopLevelElements(K){const $=[],M=[];for(let J of K)if(!K.some((j)=>j!==J&&j.contains(J)))$.push(J);else M.push(J);return{top:$,others:M}}}var H=P;class B{filters={visibility:new k,nesting:new H};async loadElements(){const K=_.join(",");let $=Array.from(document.querySelectorAll(K));const M=this.shadowRoots();for(let q=0;q<M.length;q++)$=$.concat(Array.from(M[q].querySelectorAll(K)));const J=document.querySelectorAll("*");let j=[];for(let q=0;q<J.length;q++)if(!J[q].matches(K)&&window.getComputedStyle(J[q]).cursor==="pointer")j.push(J[q]);j=Array.from(j).filter((q,W,z)=>z.indexOf(q)===W).filter((q)=>!q.closest("svg")&&!$.some((W)=>W.contains(q)));const Q=await this.filters.visibility.apply($),X=await this.filters.visibility.apply(j),U=await this.filters.nesting.apply(X.concat(Q));return Q.concat(U).filter((q,W,z)=>z.indexOf(q)===W)}shadowRoots(){const K=[],$=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode(J){return NodeFilter.FILTER_ACCEPT}});let M;while(M=$.nextNode())if(M&&M.shadowRoot)K.push(M.shadowRoot);return K}}class C{display(K){const $=[],M=[],J=[],j=()=>Math.floor(Math.random()*256);for(let Q=0;Q<K.length;Q++){const X=K[Q],U=X.getBoundingClientRect(),q=document.createElement("div");if(q.style.left=`${U.left}px`,q.style.top=`${U.top}px`,q.style.width=`${U.width}px`,q.style.height=`${U.height}px`,q.classList.add("SoM"),X.isContentEditable||A.some((z)=>X.matches(z)))q.classList.add("editable");const W=[j(),j(),j()];q.style.setProperty("--SoM-color",`${W[0]}, ${W[1]}, ${W[2]}`),document.body.appendChild(q),M.push({top:U.top,bottom:U.bottom,left:U.left,right:U.right,width:U.width,height:U.height,color:W}),J.push(q)}for(let Q=0;Q<K.length;Q++){const X=K[Q],U=M[Q],q=document.createElement("label");q.textContent=`${Q}`,q.style.color=this.colorFromLuminance(U.color),J[Q].appendChild(q);const W=q.getBoundingClientRect(),z=10,V=[];for(let Z=0;Z<=z;Z++)V.push({top:U.top-W.height,left:U.left+U.width/z*Z-W.width/2}),V.push({top:U.bottom,left:U.left+U.width/z*Z-W.width/2}),V.push({top:U.top+U.height/z*Z-W.height/2,left:U.left-W.width}),V.push({top:U.top+U.height/z*Z-W.height/2,left:U.right});const F=V.map((Z)=>{let O=0;if(Z.top<0||Z.top+W.height>window.innerHeight||Z.left<0||Z.left+W.width>window.innerWidth)O+=Infinity;else $.concat(M).forEach((G)=>{const I=Math.max(0,Math.min(Z.left+W.width,G.left+G.width)-Math.max(Z.left,G.left)),T=Math.max(0,Math.min(Z.top+W.height,G.top+G.height)-Math.max(Z.top,G.top));O+=I*T});return O}),w=V[F.indexOf(Math.min(...F))];q.style.top=`${w.top-U.top}px`,q.style.left=`${w.left-U.left}px`,$.push({top:w.top,left:w.left,right:w.left+W.width,bottom:w.top+W.height,width:W.width,height:W.height}),X.setAttribute("data-SoM",`${Q}`)}}colorFromLuminance(K){const[$,M,J]=K.map((Q)=>Q/255);return 0.299*$+0.587*M+0.114*J>0.5?"black":"white"}}var g=".SoM{position:fixed;z-index:2147483646;pointer-events:none;background-color:rgba(var(--SoM-color),.3)}.SoM.editable{background:repeating-linear-gradient(45deg,rgba(var(--SoM-color),.1),rgba(var(--SoM-color),.1) 10px,rgba(var(--SoM-color),.3) 10px,rgba(var(--SoM-color),.3) 20px)}.SoM>label{position:absolute;padding:0 3px;font-size:1rem;font-weight:700;line-height:1.2rem;white-space:nowrap;font-family:\"Courier New\",Courier,monospace;background-color:rgba(var(--SoM-color),.7)}";class u{loader=new B;ui=new C;async display(){this.log("Displaying...");const K=performance.now(),$=await this.loader.loadElements();this.clear(),this.ui.display($),this.log("Done!",`Took ${performance.now()-K}ms to display ${$.length} elements.`)}clear(){document.querySelectorAll(".SoM").forEach((K)=>{K.remove()}),document.querySelectorAll("[data-som]").forEach((K)=>{K.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((K)=>K.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((K)=>K.style.display="block")}resolve(K){return document.querySelector(`[data-som="${K}"]`)}log(...K){console.log("%cSoM","color: white; background: #007bff; padding: 2px 5px; border-radius: 5px;",...K)}}if(!document.getElementById("SoM-styles")){const K=document.createElement("style");K.id="SoM-styles",K.innerHTML=g;const $=setInterval(()=>{if(document.head)clearInterval($),document.head.appendChild(K)},100)}window.SoM=new u;window.SoM.log("Ready!");
