var O=["a[href]:not(:has(img))","a[href] img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],k=0.6,G=0.1;async function L(w){return(await Promise.all(w.map(async(q)=>{if(q.offsetWidth===0&&q.offsetHeight===0)return null;const j=window.getComputedStyle(q);if(j.display==="none"||j.visibility==="hidden")return null;let U=q.parentElement,H=!0;while(U!==null){const K=window.getComputedStyle(U);if(K.display==="none"||K.visibility==="hidden"){H=!1;break}U=U.parentElement}if(!H)return null;const W=q.getBoundingClientRect();if(W.top>=window.innerHeight||W.bottom<=0||W.left>=window.innerWidth||W.right<=0)return null;if(!await T(q))return null;return q}))).filter((q)=>q!==null)}async function T(w){return new Promise((D)=>{const q=new IntersectionObserver(async(j)=>{const U=j[0];if(q.disconnect(),U.intersectionRatio<k){D(!1);return}const H=w.getBoundingClientRect();if(H.width<=1||H.height<=1){D(!1);return}if(H.width>=window.innerWidth*0.8||H.height>=window.innerHeight*0.8){D(!1);return}const W=await S(w,H);D(W>=k)});q.observe(w)})}async function S(w,D){const q=document.createElement("canvas"),j=q.getContext("2d",{willReadFrequently:!0});if(!j)throw new Error("Could not get 2D context");const U=parseInt(window.getComputedStyle(w).zIndex||"0",10);q.width=D.width,q.height=D.height,j.fillStyle="black",j.fillRect(0,0,q.width,q.height);const H={top:Math.max(0,D.top),left:Math.max(0,D.left),bottom:Math.min(window.innerHeight,D.bottom),right:Math.min(window.innerWidth,D.right)},W={width:H.right-H.left,height:H.bottom-H.top},y=()=>{const Q=j.getImageData(H.left-D.left,H.top-D.top,W.width,W.height).data;let J=0;for(let F=0;F<Q.length;F+=4)if(Q[F]>0)J++;return J};A(w,j,D,D,"white");const K=y(),M=await Promise.all(Array.from({length:Math.ceil(1/G)}).map(async(Q,J)=>{const F=document.elementsFromPoint(D.left+D.width*G*J,D.top+D.height*G*J),Z=F.indexOf(w);return F.slice(0,Z)})),$=Array.from(new Set(M.flat().filter((Q)=>Q!==w)));let X=[];for(let Q of $){if(parseInt(window.getComputedStyle(Q).zIndex||"0",10)<U)continue;if(Q.contains(w)||w.contains(Q))continue;X.push(Q)}X=X.filter((Q)=>{for(let J of X)if(Q!==J&&J.contains(Q))return!1;return!0}),await Promise.all(X.map(async(Q)=>{const J=Q.getBoundingClientRect();A(Q,j,J,D,"black")}));const Y=y();if(q.remove(),K===0||Y===0)return 0;return Y/K}var A=function(w,D,q,j,U="black"){const H=new Path2D,W=window.getComputedStyle(w),y=W.borderRadius?.split(" ").map(($)=>parseFloat($)),K=W.clipPath,M={top:Math.max(q.top-j.top,0),bottom:Math.min(q.bottom-j.top,j.height),left:Math.max(q.left-j.left,0),right:Math.min(q.right-j.left,j.width),width:Math.min(q.right-j.left,j.width)-Math.max(q.left-j.left,0),height:Math.min(q.bottom-j.top,j.height)-Math.max(q.top-j.top,0)};if(y){if(y.length===1)y[1]=y[0];if(y.length===2)y[2]=y[0];if(y.length===3)y[3]=y[1];H.moveTo(M.left+y[0],M.top),H.arcTo(M.right,M.top,M.right,M.bottom,y[1]),H.arcTo(M.right,M.bottom,M.left,M.bottom,y[2]),H.arcTo(M.left,M.bottom,M.left,M.top,y[3]),H.arcTo(M.left,M.top,M.right,M.top,y[0])}else H.rect(M.left,M.top,M.width,M.height);if(K&&K!=="none"){const $=new Path2D(K);H.addPath($)}D.fillStyle=U,D.fill(H)};async function N(w){return(await Promise.all(w.map(async(q)=>{let j=q.parentElement;while(j!==null){if(w.includes(j))return null;j=j.parentElement}return q}))).filter((q)=>q!==null)}async function B(){const w=document.querySelectorAll(O.join(",")),D=document.querySelectorAll("*"),q=[];for(let H=0;H<D.length;H++)if(window.getComputedStyle(D[H]).cursor==="pointer")q.push(D[H]);const j=Array.from(w).concat(q).filter((H,W,y)=>y.indexOf(H)===W),U=await L(j);return await N(U)}function C(w){const D=[],q=[],j=[],U=()=>Math.floor(Math.random()*256);for(let H=0;H<w.length;H++){const y=w[H].getBoundingClientRect(),K=document.createElement("div");K.style.left=`${y.left}px`,K.style.top=`${y.top}px`,K.style.width=`${y.width}px`,K.style.height=`${y.height}px`,K.classList.add("SoM");const M=[U(),U(),U()];K.style.backgroundColor=`rgba(${M.join(",")}, 0.5)`,document.body.appendChild(K),q.push({top:y.top,bottom:y.bottom,left:y.left,right:y.right,width:y.width,height:y.height,color:M}),j.push(K)}for(let H=0;H<w.length;H++){const W=w[H],y=q[H],K=document.createElement("label");K.textContent=`${H}`,K.style.color=_(y.color),K.style.backgroundColor=`rgba(${y.color.join(",")}, 0.7)`,j[H].appendChild(K);const M=K.getBoundingClientRect(),$=10,X=[];for(let J=0;J<=$;J++)X.push({top:y.top-M.height,left:y.left+y.width/$*J-M.width/2}),X.push({top:y.bottom,left:y.left+y.width/$*J-M.width/2}),X.push({top:y.top+y.height/$*J-M.height/2,left:y.left-M.width}),X.push({top:y.top+y.height/$*J-M.height/2,left:y.right});const Y=X.map((J)=>{let F=0;if(J.top<0||J.top+M.height>window.innerHeight||J.left<0||J.left+M.width>window.innerWidth)F+=Infinity;else D.concat(q).forEach((Z)=>{const z=Math.max(0,Math.min(J.left+M.width,Z.left+Z.width)-Math.max(J.left,Z.left)),E=Math.max(0,Math.min(J.top+M.height,Z.top+Z.height)-Math.max(J.top,Z.top));F+=z*E});return F}),Q=X[Y.indexOf(Math.min(...Y))];K.style.top=`${Q.top-y.top}px`,K.style.left=`${Q.left-y.left}px`,D.push({top:Q.top,left:Q.left,right:Q.left+M.width,bottom:Q.top+M.height,width:M.width,height:M.height}),W.setAttribute("data-SoM",`${H}`)}}var _=function(w){const[D,q,j]=w.map((H)=>H/255);return 0.299*D+0.587*q+0.114*j>0.5?"black":"white"};class V{async display(){this.clear();const w=await B();C(w)}clear(){document.querySelectorAll(".SoM").forEach((w)=>{w.remove()}),document.querySelectorAll("[data-som]").forEach((w)=>{w.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="block")}}window.SoM=new V;
