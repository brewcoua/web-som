var C=["a:not(:has(img))","a img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],S=0.6,Y=0.1;class B{}class H extends B{constructor(){super(...arguments)}async apply(w){return(await Promise.all(w.map(async($)=>{if($.offsetWidth===0&&$.offsetHeight===0)return null;const K=window.getComputedStyle($);if(K.display==="none"||K.visibility==="hidden"||K.pointerEvents==="none")return null;let X=$.parentElement,U=!0;while(X!==null){const W=window.getComputedStyle(X);if(W.display==="none"||W.visibility==="hidden"||W.pointerEvents==="none"){U=!1;break}X=X.parentElement}if(!U)return null;if(!await this.isElementVisible($))return null;return $}))).filter(($)=>$!==null)}async isElementVisible(w){return new Promise((q)=>{const $=new IntersectionObserver(async(K)=>{const X=K[0];if($.disconnect(),X.intersectionRatio<S){q(!1);return}const U=w.getBoundingClientRect();if(U.width<=1||U.height<=1){q(!1);return}if(U.width>=window.innerWidth*0.8||U.height>=window.innerHeight*0.8){q(!1);return}const Q=await this.getVisibilityRatio(w,U);q(Q>=S)});$.observe(w)})}async getVisibilityRatio(w,q){const $=document.createElement("canvas"),K=$.getContext("2d",{willReadFrequently:!0});if(!K)throw new Error("Could not get 2D context");const X=parseInt(window.getComputedStyle(w).zIndex||"0",10);$.width=q.width,$.height=q.height,K.fillStyle="black",K.fillRect(0,0,$.width,$.height);const U={top:Math.max(0,q.top),left:Math.max(0,q.left),bottom:Math.min(window.innerHeight,q.bottom),right:Math.min(window.innerWidth,q.right),width:q.width,height:q.height};U.width=U.right-U.left,U.height=U.bottom-U.top,this.drawElement(w,K,q,q,"white");const Q=this.countVisiblePixels(K,{top:U.top-q.top,left:U.left-q.left,width:$.width,height:$.height}),W=await Promise.all(Array.from({length:Math.ceil(1/Y)}).map(async(j,y)=>{return Promise.all(Array.from({length:Math.ceil(1/Y)}).map(async(z,D)=>{const G=document.elementsFromPoint(q.left+q.width*Y*y,q.top+q.height*Y*D);if(!G.includes(w))return[];const V=G.indexOf(w);return G.slice(0,V)}))})),M=Array.from(new Set(W.flat(2).filter((j)=>j!==w)));let J=[];for(let j of M){if(parseInt(window.getComputedStyle(j).zIndex||"0",10)<X)continue;if(j.contains(w)||w.contains(j))continue;J.push(j)}J=J.filter((j)=>{for(let y of J)if(j!==y&&y.contains(j))return!1;return!0}),await Promise.all(J.map(async(j)=>{const y=j.getBoundingClientRect();this.drawElement(j,K,y,q,"black")}));const Z=this.countVisiblePixels(K,{top:U.top-q.top,left:U.left-q.left,width:U.width,height:U.height});if($.remove(),Q===0)return 0;return Z/Q}countVisiblePixels(w,q){const $=w.getImageData(q.left,q.top,q.width,q.height).data;let K=0;for(let X=0;X<$.length;X+=4)if($[X]>0)K++;return K}drawElement(w,q,$,K,X="black"){const U=window.getComputedStyle(w),Q=U.borderRadius?.split(" ").map((J)=>parseFloat(J)),W=U.clipPath,M={top:$.top-K.top,bottom:$.bottom-K.top,left:$.left-K.left,right:$.right-K.left,width:$.width,height:$.height};if(M.width=M.right-M.left,M.height=M.bottom-M.top,q.fillStyle=X,W&&W!=="none")W.split(/,| /).forEach((Z)=>{const j=Z.trim().match(/^([a-z]+)\((.*)\)$/);if(!j)return;switch(j[0]){case"polygon":const y=this.pathFromPolygon(Z,$);q.fill(y);break;default:console.log("Unknown clip path kind: "+j)}});else if(Q){const J=new Path2D;if(Q.length===1)Q[1]=Q[0];if(Q.length===2)Q[2]=Q[0];if(Q.length===3)Q[3]=Q[1];J.moveTo(M.left+Q[0],M.top),J.arcTo(M.right,M.top,M.right,M.bottom,Q[1]),J.arcTo(M.right,M.bottom,M.left,M.bottom,Q[2]),J.arcTo(M.left,M.bottom,M.left,M.top,Q[3]),J.arcTo(M.left,M.top,M.right,M.top,Q[0]),J.closePath(),q.fill(J)}else q.fillRect(M.left,M.top,M.width,M.height)}pathFromPolygon(w,q){if(!w||!w.match(/^polygon\((.*)\)$/))throw new Error("Invalid polygon format: "+w);const $=new Path2D,K=w.match(/\d+(\.\d+)?%/g);if(K&&K.length>=2){const X=parseFloat(K[0]),U=parseFloat(K[1]);$.moveTo(X*q.width/100,U*q.height/100);for(let Q=2;Q<K.length;Q+=2){const W=parseFloat(K[Q]),M=parseFloat(K[Q+1]);$.lineTo(W*q.width/100,M*q.height/100)}$.closePath()}return $}}var u=H;var k=0.9,I=3,P=["a","button","input","select","textarea"];class N extends B{constructor(){super(...arguments)}async apply(w){const{top:q,others:$}=this.getTopLevelElements(w);return(await Promise.all(q.map(async(X)=>this.compareTopWithChildren(X,$)))).flat()}async compareTopWithChildren(w,q){if(P.some((Q)=>w.matches(Q)))return[w];const $=this.getBranches(w,q),K=w.getBoundingClientRect();if($.length<=1)return[w];const U=(await Promise.all($.map(async(Q)=>{const W=Q.top.getBoundingClientRect();if(W.width/K.width<k&&W.height/K.height<k)return[];if(Q.children.length===0)return[Q.top];return await this.compareTopWithChildren(Q.top,Q.children)}))).flat();if(U.length>I)return U;return[w,...U]}getBranches(w,q){const $=this.getFirstHitChildren(w,q);return $.map((K)=>{const X=q.filter((U)=>!$.includes(U)&&K.contains(U));return{top:K,children:X}})}getFirstHitChildren(w,q){const $=w.querySelectorAll(":scope > *"),K=Array.from($).filter((X)=>q.includes(X));if(K.length>0)return K;return Array.from($).flatMap((X)=>this.getFirstHitChildren(X,q))}getTopLevelElements(w){const q=[],$=[];for(let K of w)if(!w.some((X)=>X!==K&&X.contains(K)))q.push(K);else $.push(K);return{top:q,others:$}}}var A=N;class F{filters={visibility:new u,nesting:new A};async loadElements(){const w=C.join(",");let q=Array.from(document.querySelectorAll(w));const $=this.shadowRoots();for(let M=0;M<$.length;M++)q=q.concat(Array.from($[M].querySelectorAll(w)));const K=document.querySelectorAll("*");let X=[];for(let M=0;M<K.length;M++)if(!K[M].matches(w)&&window.getComputedStyle(K[M]).cursor==="pointer")X.push(K[M]);X=Array.from(X).filter((M,J,Z)=>Z.indexOf(M)===J).filter((M)=>!M.closest("svg")&&!q.some((J)=>J.contains(M)));const U=await this.filters.visibility.apply(q),Q=await this.filters.visibility.apply(X),W=await this.filters.nesting.apply(Q.concat(U));return U.concat(W).filter((M,J,Z)=>Z.indexOf(M)===J)}shadowRoots(){const w=[],q=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode(K){return NodeFilter.FILTER_ACCEPT}});let $;while($=q.nextNode())if($&&$.shadowRoot)w.push($.shadowRoot);return w}}class O{display(w){const q=[],$=[],K=[],X=()=>Math.floor(Math.random()*256);for(let U=0;U<w.length;U++){const W=w[U].getBoundingClientRect(),M=document.createElement("div");M.style.left=`${W.left}px`,M.style.top=`${W.top}px`,M.style.width=`${W.width}px`,M.style.height=`${W.height}px`,M.classList.add("SoM");const J=[X(),X(),X()];M.style.backgroundColor=`rgba(${J.join(",")}, 0.3)`,document.body.appendChild(M),$.push({top:W.top,bottom:W.bottom,left:W.left,right:W.right,width:W.width,height:W.height,color:J}),K.push(M)}for(let U=0;U<w.length;U++){const Q=w[U],W=$[U],M=document.createElement("label");M.textContent=`${U}`,M.style.color=this.colorFromLuminance(W.color),M.style.backgroundColor=`rgba(${W.color.join(",")}, 0.5)`,K[U].appendChild(M);const J=M.getBoundingClientRect(),Z=10,j=[];for(let D=0;D<=Z;D++)j.push({top:W.top-J.height,left:W.left+W.width/Z*D-J.width/2}),j.push({top:W.bottom,left:W.left+W.width/Z*D-J.width/2}),j.push({top:W.top+W.height/Z*D-J.height/2,left:W.left-J.width}),j.push({top:W.top+W.height/Z*D-J.height/2,left:W.right});const y=j.map((D)=>{let G=0;if(D.top<0||D.top+J.height>window.innerHeight||D.left<0||D.left+J.width>window.innerWidth)G+=Infinity;else q.concat($).forEach((V)=>{const _=Math.max(0,Math.min(D.left+J.width,V.left+V.width)-Math.max(D.left,V.left)),T=Math.max(0,Math.min(D.top+J.height,V.top+V.height)-Math.max(D.top,V.top));G+=_*T});return G}),z=j[y.indexOf(Math.min(...y))];M.style.top=`${z.top-W.top}px`,M.style.left=`${z.left-W.left}px`,q.push({top:z.top,left:z.left,right:z.left+J.width,bottom:z.top+J.height,width:J.width,height:J.height}),Q.setAttribute("data-SoM",`${U}`)}}colorFromLuminance(w){const[q,$,K]=w.map((U)=>U/255);return 0.299*q+0.587*$+0.114*K>0.5?"black":"white"}}class L{loader=new F;ui=new O;async display(){this.log("Displaying...");const w=performance.now(),q=await this.loader.loadElements();this.clear(),this.ui.display(q),this.log("Done!",`Took ${performance.now()-w}ms to display ${q.length} elements.`)}clear(){document.querySelectorAll(".SoM").forEach((w)=>{w.remove()}),document.querySelectorAll("[data-som]").forEach((w)=>{w.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="block")}resolve(w){return document.querySelector(`[data-som="${w}"]`)}log(...w){console.log("%cSoM","color: white; background: #007bff; padding: 2px 5px; border-radius: 5px;",...w)}}window.SoM=new L;window.SoM.log("Ready!");
