var A=["a:not(:has(img))","a img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],C=0.6,G=0.1;class S{}class H extends S{constructor(){super(...arguments)}async apply(M){return(await Promise.all(M.map(async(y)=>{if(y.offsetWidth===0&&y.offsetHeight===0)return null;const $=window.getComputedStyle(y);if($.display==="none"||$.visibility==="hidden"||$.pointerEvents==="none")return null;let Q=y.parentElement,K=!0;while(Q!==null){const U=window.getComputedStyle(Q);if(U.display==="none"||U.visibility==="hidden"||U.pointerEvents==="none"){K=!1;break}Q=Q.parentElement}if(!K)return null;if(!await this.isElementVisible(y))return null;return y}))).filter((y)=>y!==null)}async isElementVisible(M){return new Promise((w)=>{const y=new IntersectionObserver(async($)=>{const Q=$[0];if(y.disconnect(),Q.intersectionRatio<C){w(!1);return}const K=M.getBoundingClientRect();if(K.width<=1||K.height<=1){w(!1);return}if(K.width>=window.innerWidth*0.8||K.height>=window.innerHeight*0.8){w(!1);return}const J=await this.getVisibilityRatio(M,K);w(J>=C)});y.observe(M)})}async getVisibilityRatio(M,w){const y=document.createElement("canvas"),$=y.getContext("2d",{willReadFrequently:!0});if(!$)throw new Error("Could not get 2D context");const Q=parseInt(window.getComputedStyle(M).zIndex||"0",10);y.width=w.width,y.height=w.height,$.fillStyle="black",$.fillRect(0,0,y.width,y.height);const K={top:Math.max(0,w.top),left:Math.max(0,w.left),bottom:Math.min(window.innerHeight,w.bottom),right:Math.min(window.innerWidth,w.right),width:w.width,height:w.height};K.width=K.right-K.left,K.height=K.bottom-K.top,this.drawElement(M,$,w,w,"white");const J=this.countVisiblePixels($,{top:K.top-w.top,left:K.left-w.left,width:y.width,height:y.height}),U=await Promise.all(Array.from({length:Math.ceil(1/G)}).map(async(X,D)=>{return Promise.all(Array.from({length:Math.ceil(1/G)}).map(async(u,j)=>{const V=document.elementsFromPoint(w.left+w.width*G*D,w.top+w.height*G*j);if(!V.includes(M))return[];const Z=V.indexOf(M);return V.slice(0,Z)}))})),q=Array.from(new Set(U.flat(2).filter((X)=>X!==M)));let W=[];for(let X of q){if(parseInt(window.getComputedStyle(X).zIndex||"0",10)<Q)continue;if(X.contains(M)||M.contains(X))continue;W.push(X)}W=W.filter((X)=>{for(let D of W)if(X!==D&&D.contains(X))return!1;return!0}),await Promise.all(W.map(async(X)=>{const D=X.getBoundingClientRect();this.drawElement(X,$,D,w,"black")}));const z=this.countVisiblePixels($,{top:K.top-w.top,left:K.left-w.left,width:K.width,height:K.height});if(y.remove(),J===0)return 0;return z/J}countVisiblePixels(M,w){const y=M.getImageData(w.left,w.top,w.width,w.height).data;let $=0;for(let Q=0;Q<y.length;Q+=4)if(y[Q]>0)$++;return $}drawElement(M,w,y,$,Q="black"){const K=window.getComputedStyle(M),J=K.borderRadius?.split(" ").map((W)=>parseFloat(W)),U=K.clipPath,q={top:y.top-$.top,bottom:y.bottom-$.top,left:y.left-$.left,right:y.right-$.left,width:y.width,height:y.height};if(q.width=q.right-q.left,q.height=q.bottom-q.top,w.fillStyle=Q,U&&U!=="none")U.split(/,| /).forEach((z)=>{const X=z.trim().match(/^([a-z]+)\((.*)\)$/);if(!X)return;switch(X[0]){case"polygon":const D=this.pathFromPolygon(z,y);w.fill(D);break;default:console.log("Unknown clip path kind: "+X)}});else if(J){const W=new Path2D;if(J.length===1)J[1]=J[0];if(J.length===2)J[2]=J[0];if(J.length===3)J[3]=J[1];W.moveTo(q.left+J[0],q.top),W.arcTo(q.right,q.top,q.right,q.bottom,J[1]),W.arcTo(q.right,q.bottom,q.left,q.bottom,J[2]),W.arcTo(q.left,q.bottom,q.left,q.top,J[3]),W.arcTo(q.left,q.top,q.right,q.top,J[0]),W.closePath(),w.fill(W)}else w.fillRect(q.left,q.top,q.width,q.height)}pathFromPolygon(M,w){if(!M||!M.match(/^polygon\((.*)\)$/))throw new Error("Invalid polygon format: "+M);const y=new Path2D,$=M.match(/\d+(\.\d+)?%/g);if($&&$.length>=2){const Q=parseFloat($[0]),K=parseFloat($[1]);y.moveTo(Q*w.width/100,K*w.height/100);for(let J=2;J<$.length;J+=2){const U=parseFloat($[J]),q=parseFloat($[J+1]);y.lineTo(U*w.width/100,q*w.height/100)}y.closePath()}return y}}var F=H;var N=0.9,I=3,P=["a","button","input","select","textarea"];class k extends S{constructor(){super(...arguments)}async apply(M){const{top:w,others:y}=this.getTopLevelElements(M);return(await Promise.all(w.map(async(Q)=>this.compareTopWithChildren(Q,y)))).flat()}async compareTopWithChildren(M,w){if(P.some((J)=>M.matches(J)))return[M];const y=this.getBranches(M,w),$=M.getBoundingClientRect();if(y.length<=1)return[M];const K=(await Promise.all(y.map(async(J)=>{const U=J.top.getBoundingClientRect();if(U.width/$.width<N&&U.height/$.height<N)return[];if(J.children.length===0)return[J.top];return await this.compareTopWithChildren(J.top,J.children)}))).flat();if(K.length>I)return K;return[M,...K]}getBranches(M,w){const y=this.getFirstHitChildren(M,w);return y.map(($)=>{const Q=w.filter((K)=>!y.includes(K)&&$.contains(K));return{top:$,children:Q}})}getFirstHitChildren(M,w){const y=M.querySelectorAll(":scope > *"),$=Array.from(y).filter((Q)=>w.includes(Q));if($.length>0)return $;return Array.from(y).flatMap((Q)=>this.getFirstHitChildren(Q,w))}getTopLevelElements(M){const w=[],y=[];for(let $ of M)if(!M.some((Q)=>Q!==$&&Q.contains($)))w.push($);else y.push($);return{top:w,others:y}}}var O=k;class Y{filters={visibility:new F,nesting:new O};async loadElements(){const M=A.join(",");let w=Array.from(document.querySelectorAll(M));const y=this.shadowRoots();for(let q=0;q<y.length;q++)w=w.concat(Array.from(y[q].querySelectorAll(M)));const $=document.querySelectorAll("*");let Q=[];for(let q=0;q<$.length;q++)if(!$[q].matches(M)&&window.getComputedStyle($[q]).cursor==="pointer")Q.push($[q]);Q=Array.from(Q).filter((q,W,z)=>z.indexOf(q)===W).filter((q)=>!q.closest("svg")&&!w.some((W)=>W.contains(q)));const K=await this.filters.visibility.apply(w),J=await this.filters.visibility.apply(Q),U=await this.filters.nesting.apply(J.concat(K));return K.concat(U).filter((q,W,z)=>z.indexOf(q)===W)}shadowRoots(){const M=[],w=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode($){return NodeFilter.FILTER_ACCEPT}});let y;while(y=w.nextNode())if(y&&y.shadowRoot)M.push(y.shadowRoot);return M}}class B{display(M){const w=[],y=[],$=[],Q=()=>Math.floor(Math.random()*256);for(let K=0;K<M.length;K++){const U=M[K].getBoundingClientRect(),q=document.createElement("div");q.style.left=`${U.left}px`,q.style.top=`${U.top}px`,q.style.width=`${U.width}px`,q.style.height=`${U.height}px`,q.classList.add("SoM");const W=[Q(),Q(),Q()];q.style.backgroundColor=`rgba(${W.join(",")}, 0.3)`,document.body.appendChild(q),y.push({top:U.top,bottom:U.bottom,left:U.left,right:U.right,width:U.width,height:U.height,color:W}),$.push(q)}for(let K=0;K<M.length;K++){const J=M[K],U=y[K],q=document.createElement("label");q.textContent=`${K}`,q.style.color=this.colorFromLuminance(U.color),q.style.backgroundColor=`rgba(${U.color.join(",")}, 0.5)`,$[K].appendChild(q);const W=q.getBoundingClientRect(),z=10,X=[];for(let j=0;j<=z;j++)X.push({top:U.top-W.height,left:U.left+U.width/z*j-W.width/2}),X.push({top:U.bottom,left:U.left+U.width/z*j-W.width/2}),X.push({top:U.top+U.height/z*j-W.height/2,left:U.left-W.width}),X.push({top:U.top+U.height/z*j-W.height/2,left:U.right});const D=X.map((j)=>{let V=0;if(j.top<0||j.top+W.height>window.innerHeight||j.left<0||j.left+W.width>window.innerWidth)V+=Infinity;else w.concat(y).forEach((Z)=>{const T=Math.max(0,Math.min(j.left+W.width,Z.left+Z.width)-Math.max(j.left,Z.left)),g=Math.max(0,Math.min(j.top+W.height,Z.top+Z.height)-Math.max(j.top,Z.top));V+=T*g});return V}),u=X[D.indexOf(Math.min(...D))];q.style.top=`${u.top-U.top}px`,q.style.left=`${u.left-U.left}px`,w.push({top:u.top,left:u.left,right:u.left+W.width,bottom:u.top+W.height,width:W.width,height:W.height}),J.setAttribute("data-SoM",`${K}`)}}colorFromLuminance(M){const[w,y,$]=M.map((K)=>K/255);return 0.299*w+0.587*y+0.114*$>0.5?"black":"white"}}var L=".SoM{position:fixed;z-index:2147483646;pointer-events:none}.SoM>label{position:absolute;padding:0 3px;font-size:1rem;font-weight:700;line-height:1.2rem;white-space:nowrap;font-family:\"Courier New\",Courier,monospace}";class _{loader=new Y;ui=new B;async display(){this.log("Displaying...");const M=performance.now(),w=await this.loader.loadElements();this.clear(),this.ui.display(w),this.log("Done!",`Took ${performance.now()-M}ms to display ${w.length} elements.`)}clear(){document.querySelectorAll(".SoM").forEach((M)=>{M.remove()}),document.querySelectorAll("[data-som]").forEach((M)=>{M.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((M)=>M.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((M)=>M.style.display="block")}resolve(M){return document.querySelector(`[data-som="${M}"]`)}log(...M){console.log("%cSoM","color: white; background: #007bff; padding: 2px 5px; border-radius: 5px;",...M)}}if(!document.getElementById("SoM-styles")){const M=document.createElement("style");M.id="SoM-styles",M.innerHTML=L,document.head.appendChild(M)}window.SoM=new _;window.SoM.log("Ready!");
