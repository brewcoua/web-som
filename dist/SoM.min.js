var A=["a:not(:has(img))","a img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],N=0.6,F=0.1;class M{}class k extends M{constructor(){super(...arguments)}async apply(K){return(await Promise.all(K.map(async(J)=>{if(J.offsetWidth===0&&J.offsetHeight===0)return null;const Q=window.getComputedStyle(J);if(Q.display==="none"||Q.visibility==="hidden"||Q.pointerEvents==="none")return null;let z=J.parentElement,X=!0;while(z!==null){const U=window.getComputedStyle(z);if(U.display==="none"||U.visibility==="hidden"||U.pointerEvents==="none"){X=!1;break}z=z.parentElement}if(!X)return null;if(!await this.isElementVisible(J))return null;return J}))).filter((J)=>J!==null)}async isElementVisible(K){return new Promise(($)=>{const J=new IntersectionObserver(async(Q)=>{const z=Q[0];if(J.disconnect(),z.intersectionRatio<N){$(!1);return}const X=K.getBoundingClientRect();if(X.width<=1||X.height<=1){$(!1);return}if(X.width>=window.innerWidth*0.8||X.height>=window.innerHeight*0.8){$(!1);return}const j=await this.getVisibilityRatio(K,X);$(j>=N)});J.observe(K)})}async getVisibilityRatio(K,$){const J=document.createElement("canvas"),Q=J.getContext("2d",{willReadFrequently:!0});if(!Q)throw new Error("Could not get 2D context");const z=parseInt(window.getComputedStyle(K).zIndex||"0",10);J.width=$.width,J.height=$.height,Q.fillStyle="black",Q.fillRect(0,0,J.width,J.height);const X={top:Math.max(0,$.top),left:Math.max(0,$.left),bottom:Math.min(window.innerHeight,$.bottom),right:Math.min(window.innerWidth,$.right),width:$.width,height:$.height};X.width=X.right-X.left,X.height=X.bottom-X.top,this.drawElement(K,Q,$,$,"white");const j=this.countVisiblePixels(Q,{top:X.top-$.top,left:X.left-$.left,width:J.width,height:J.height}),U=await Promise.all(Array.from({length:Math.ceil(1/F)}).map(async(Z,G)=>{return Promise.all(Array.from({length:Math.ceil(1/F)}).map(async(w,V)=>{const B=document.elementsFromPoint($.left+$.width*F*G,$.top+$.height*F*V);if(!B.includes(K))return[];const Y=B.indexOf(K);return B.slice(0,Y)}))})),q=Array.from(new Set(U.flat(2).filter((Z)=>Z!==K)));let W=[];for(let Z of q){if(parseInt(window.getComputedStyle(Z).zIndex||"0",10)<z)continue;if(Z.contains(K)||K.contains(Z))continue;W.push(Z)}W=W.filter((Z)=>{for(let G of W)if(Z!==G&&G.contains(Z))return!1;return!0}),await Promise.all(W.map(async(Z)=>{const G=Z.getBoundingClientRect();this.drawElement(Z,Q,G,$,"black")}));const D=this.countVisiblePixels(Q,{top:X.top-$.top,left:X.left-$.left,width:X.width,height:X.height});if(J.remove(),j===0)return 0;return D/j}countVisiblePixels(K,$){const J=K.getImageData($.left,$.top,$.width,$.height).data;let Q=0;for(let z=0;z<J.length;z+=4)if(J[z]>0)Q++;return Q}drawElement(K,$,J,Q,z="black"){const X=window.getComputedStyle(K),j=X.borderRadius?.split(" ").map((W)=>parseFloat(W)),U=X.clipPath,q={top:J.top-Q.top,bottom:J.bottom-Q.top,left:J.left-Q.left,right:J.right-Q.left,width:J.width,height:J.height};if(q.width=q.right-q.left,q.height=q.bottom-q.top,$.fillStyle=z,U&&U!=="none")U.split(/,| /).forEach((D)=>{const Z=D.trim().match(/^([a-z]+)\((.*)\)$/);if(!Z)return;switch(Z[0]){case"polygon":const G=this.pathFromPolygon(D,J);$.fill(G);break;default:console.log("Unknown clip path kind: "+Z)}});else if(j){const W=new Path2D;if(j.length===1)j[1]=j[0];if(j.length===2)j[2]=j[0];if(j.length===3)j[3]=j[1];W.moveTo(q.left+j[0],q.top),W.arcTo(q.right,q.top,q.right,q.bottom,j[1]),W.arcTo(q.right,q.bottom,q.left,q.bottom,j[2]),W.arcTo(q.left,q.bottom,q.left,q.top,j[3]),W.arcTo(q.left,q.top,q.right,q.top,j[0]),W.closePath(),$.fill(W)}else $.fillRect(q.left,q.top,q.width,q.height)}pathFromPolygon(K,$){if(!K||!K.match(/^polygon\((.*)\)$/))throw new Error("Invalid polygon format: "+K);const J=new Path2D,Q=K.match(/\d+(\.\d+)?%/g);if(Q&&Q.length>=2){const z=parseFloat(Q[0]),X=parseFloat(Q[1]);J.moveTo(z*$.width/100,X*$.height/100);for(let j=2;j<Q.length;j+=2){const U=parseFloat(Q[j]),q=parseFloat(Q[j+1]);J.lineTo(U*$.width/100,q*$.height/100)}J.closePath()}return J}}var H=k;var L=0.9,y=3,g=["a","button","input","select","textarea"];class P extends M{constructor(){super(...arguments)}async apply(K){const{top:$,others:J}=this.getTopLevelElements(K);return(await Promise.all($.map(async(z)=>this.compareTopWithChildren(z,J)))).flat()}async compareTopWithChildren(K,$){if(g.some((j)=>K.matches(j)))return[K];const J=this.getBranches(K,$),Q=K.getBoundingClientRect();if(J.length<=1)return[K];const X=(await Promise.all(J.map(async(j)=>{const U=j.top.getBoundingClientRect();if(U.width/Q.width<L&&U.height/Q.height<L)return[];if(j.children.length===0)return[j.top];return await this.compareTopWithChildren(j.top,j.children)}))).flat();if(X.length>y)return X;return[K,...X]}getBranches(K,$){const J=this.getFirstHitChildren(K,$);return J.map((Q)=>{const z=$.filter((X)=>!J.includes(X)&&Q.contains(X));return{top:Q,children:z}})}getFirstHitChildren(K,$){const J=K.querySelectorAll(":scope > *"),Q=Array.from(J).filter((z)=>$.includes(z));if(Q.length>0)return Q;return Array.from(J).flatMap((z)=>this.getFirstHitChildren(z,$))}getTopLevelElements(K){const $=[],J=[];for(let Q of K)if(!K.some((z)=>z!==Q&&z.contains(Q)))$.push(Q);else J.push(Q);return{top:$,others:J}}}var _=P;class C{filters={visibility:new H,nesting:new _};async loadElements(){const K=A.join(",");let $=Array.from(document.querySelectorAll(K));const J=this.shadowRoots();for(let q=0;q<J.length;q++)$=$.concat(Array.from(J[q].querySelectorAll(K)));const Q=document.querySelectorAll("*");let z=[];for(let q=0;q<Q.length;q++)if(!Q[q].matches(K)&&window.getComputedStyle(Q[q]).cursor==="pointer")z.push(Q[q]);z=Array.from(z).filter((q,W,D)=>D.indexOf(q)===W).filter((q)=>!q.closest("svg")&&!$.some((W)=>W.contains(q)));const X=await this.filters.visibility.apply($),j=await this.filters.visibility.apply(z),U=await this.filters.nesting.apply(j.concat(X));return X.concat(U).filter((q,W,D)=>D.indexOf(q)===W)}shadowRoots(){const K=[],$=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode(Q){return NodeFilter.FILTER_ACCEPT}});let J;while(J=$.nextNode())if(J&&J.shadowRoot)K.push(J.shadowRoot);return K}}class O{display(K){const $=[],J=[],Q=[],z=()=>Math.floor(Math.random()*256);for(let X=0;X<K.length;X++){const U=K[X].getBoundingClientRect(),q=document.createElement("div");q.style.left=`${U.left}px`,q.style.top=`${U.top}px`,q.style.width=`${U.width}px`,q.style.height=`${U.height}px`,q.classList.add("SoM");const W=[z(),z(),z()];q.style.backgroundColor=`rgba(${W.join(",")}, 0.3)`,document.body.appendChild(q),J.push({top:U.top,bottom:U.bottom,left:U.left,right:U.right,width:U.width,height:U.height,color:W}),Q.push(q)}for(let X=0;X<K.length;X++){const j=K[X],U=J[X],q=document.createElement("label");q.textContent=`${X}`,q.style.color=this.colorFromLuminance(U.color),q.style.backgroundColor=`rgba(${U.color.join(",")}, 0.5)`,Q[X].appendChild(q);const W=q.getBoundingClientRect(),D=10,Z=[];for(let V=0;V<=D;V++)Z.push({top:U.top-W.height,left:U.left+U.width/D*V-W.width/2}),Z.push({top:U.bottom,left:U.left+U.width/D*V-W.width/2}),Z.push({top:U.top+U.height/D*V-W.height/2,left:U.left-W.width}),Z.push({top:U.top+U.height/D*V-W.height/2,left:U.right});const G=Z.map((V)=>{let B=0;if(V.top<0||V.top+W.height>window.innerHeight||V.left<0||V.left+W.width>window.innerWidth)B+=Infinity;else $.concat(J).forEach((Y)=>{const I=Math.max(0,Math.min(V.left+W.width,Y.left+Y.width)-Math.max(V.left,Y.left)),u=Math.max(0,Math.min(V.top+W.height,Y.top+Y.height)-Math.max(V.top,Y.top));B+=I*u});return B}),w=Z[G.indexOf(Math.min(...G))];q.style.top=`${w.top-U.top}px`,q.style.left=`${w.left-U.left}px`,$.push({top:w.top,left:w.left,right:w.left+W.width,bottom:w.top+W.height,width:W.width,height:W.height}),j.setAttribute("data-SoM",`${X}`)}}colorFromLuminance(K){const[$,J,Q]=K.map((X)=>X/255);return 0.299*$+0.587*J+0.114*Q>0.5?"black":"white"}}var S=".SoM{position:fixed;z-index:2147483646;pointer-events:none}.SoM>label{position:absolute;padding:0 3px;font-size:1rem;font-weight:700;line-height:1.2rem;white-space:nowrap;font-family:\"Courier New\",Courier,monospace}";class T{loader=new C;ui=new O;async display(){this.log("Displaying...");const K=performance.now(),$=await this.loader.loadElements();this.clear(),this.ui.display($),this.log("Done!",`Took ${performance.now()-K}ms to display ${$.length} elements.`)}clear(){document.querySelectorAll(".SoM").forEach((K)=>{K.remove()}),document.querySelectorAll("[data-som]").forEach((K)=>{K.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((K)=>K.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((K)=>K.style.display="block")}resolve(K){return document.querySelector(`[data-som="${K}"]`)}log(...K){console.log("%cSoM","color: white; background: #007bff; padding: 2px 5px; border-radius: 5px;",...K)}}if(!document.getElementById("SoM-styles")){const K=document.createElement("style");K.id="SoM-styles",K.innerHTML=S;const $=setInterval(()=>{if(document.head)clearInterval($),document.head.appendChild(K)},100)}window.SoM=new T;window.SoM.log("Ready!");
