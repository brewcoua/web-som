var A=["a:not(:has(img))","a img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],y=['input[type="text"]','input[type="password"]','input[type="email"]','input[type="tel"]','input[type="number"]','input[type="search"]','input[type="url"]','input[type="date"]','input[type="time"]','input[type="datetime-local"]','input[type="month"]','input[type="week"]','input[type="color"]',"textarea",'[contenteditable="true"]'],P=0.6,M=0.2,u=200,S=0.7,_=0.25,L=0.3;class q{}class I extends q{constructor(){super(...arguments)}async apply(K){return(await Promise.all(K.map(async($)=>{if($.offsetWidth===0&&$.offsetHeight===0)return null;const Q=window.getComputedStyle($);if(Q.display==="none"||Q.visibility==="hidden"||Q.pointerEvents==="none")return null;let W=$.parentElement,X=!0;while(W!==null){const Z=window.getComputedStyle(W);if(Z.display==="none"||Z.visibility==="hidden"||Z.pointerEvents==="none"){X=!1;break}W=W.parentElement}if(!X)return null;if(!await this.isElementVisible($))return null;return $}))).filter(($)=>$!==null)}async isElementVisible(K){return new Promise((J)=>{const $=new IntersectionObserver(async(Q)=>{const W=Q[0];if($.disconnect(),W.intersectionRatio<P){J(!1);return}const X=K.getBoundingClientRect();if(X.width<=1||X.height<=1){J(!1);return}if(X.width>=window.innerWidth*0.8||X.height>=window.innerHeight*0.8){J(!1);return}const j=await this.getVisibilityRatio(K,X);J(j>=P)});$.observe(K)})}async getVisibilityRatio(K,J){const $=document.createElement("canvas"),Q=$.getContext("2d",{willReadFrequently:!0});if(!Q)throw new Error("Could not get 2D context");const W=parseInt(window.getComputedStyle(K).zIndex||"0",10);$.width=J.width,$.height=J.height,Q.fillStyle="black",Q.fillRect(0,0,$.width,$.height);const X={top:Math.max(0,J.top),left:Math.max(0,J.left),bottom:Math.min(window.innerHeight,J.bottom),right:Math.min(window.innerWidth,J.right),width:J.width,height:J.height};X.width=X.right-X.left,X.height=X.bottom-X.top,this.drawElement(K,Q,J,J,"white");const j=this.countVisiblePixels(Q,{top:X.top-J.top,left:X.left-J.left,width:$.width,height:$.height}),Z=await this.getIntersectingElements(K);await Promise.all(Z.map(async(Y)=>{const V=Y.getBoundingClientRect();this.drawElement(Y,Q,V,J,"black")}));const z=this.countVisiblePixels(Q,{top:X.top-J.top,left:X.left-J.left,width:X.width,height:X.height});if($.remove(),j===0)return 0;return z/j}async getIntersectingElements(K){const J=parseInt(window.getComputedStyle(K).zIndex||"0",10),$=K.getBoundingClientRect(),Q=await Promise.all(Array.from({length:Math.ceil(1/M)}).map(async(j,Z)=>{return Array.from({length:Math.ceil(1/M)}).map((z,Y)=>{const V=document.elementsFromPoint($.left+$.width*M*Z,$.top+$.height*M*Y);if(!V.includes(K))return[];const D=V.indexOf(K);return V.slice(0,D)})})),W=Array.from(new Set(Q.flat(2).filter((j)=>j!==K)));let X=[];for(let j of W){if(parseInt(window.getComputedStyle(j).zIndex||"0",10)<J)continue;if(j.contains(K)||K.contains(j))continue;X.push(j)}return X=X.filter((j)=>{for(let Z of X)if(j!==Z&&Z.contains(j))return!1;return!0}),X}countVisiblePixels(K,J){const $=K.getImageData(J.left,J.top,J.width,J.height).data;let Q=0;for(let W=0;W<$.length;W+=4)if($[W]>0)Q++;return Q}drawElement(K,J,$,Q,W="black"){const X=window.getComputedStyle(K),j=X.borderRadius?.split(" ").map((Y)=>parseFloat(Y)),Z=X.clipPath,z={top:$.top-Q.top,bottom:$.bottom-Q.top,left:$.left-Q.left,right:$.right-Q.left,width:$.width,height:$.height};if(z.width=z.right-z.left,z.height=z.bottom-z.top,J.fillStyle=W,Z&&Z!=="none")Z.split(/,| /).forEach((V)=>{const D=V.trim().match(/^([a-z]+)\((.*)\)$/);if(!D)return;switch(D[0]){case"polygon":const w=this.pathFromPolygon(V,$);J.fill(w);break;default:console.log("Unknown clip path kind: "+D)}});else if(j){const Y=new Path2D;if(j.length===1)j[1]=j[0];if(j.length===2)j[2]=j[0];if(j.length===3)j[3]=j[1];Y.moveTo(z.left+j[0],z.top),Y.arcTo(z.right,z.top,z.right,z.bottom,j[1]),Y.arcTo(z.right,z.bottom,z.left,z.bottom,j[2]),Y.arcTo(z.left,z.bottom,z.left,z.top,j[3]),Y.arcTo(z.left,z.top,z.right,z.top,j[0]),Y.closePath(),J.fill(Y)}else J.fillRect(z.left,z.top,z.width,z.height)}pathFromPolygon(K,J){if(!K||!K.match(/^polygon\((.*)\)$/))throw new Error("Invalid polygon format: "+K);const $=new Path2D,Q=K.match(/\d+(\.\d+)?%/g);if(Q&&Q.length>=2){const W=parseFloat(Q[0]),X=parseFloat(Q[1]);$.moveTo(W*J.width/100,X*J.height/100);for(let j=2;j<Q.length;j+=2){const Z=parseFloat(Q[j]),z=parseFloat(Q[j+1]);$.lineTo(Z*J.width/100,z*J.height/100)}$.closePath()}return $}}var N=I;var C=0.9,p=3,d=["a","button","input","select","textarea"];class v extends q{constructor(){super(...arguments)}async apply(K){const{top:J,others:$}=this.getTopLevelElements(K);return(await Promise.all(J.map(async(W)=>this.compareTopWithChildren(W,$)))).flat()}async compareTopWithChildren(K,J){if(d.some((j)=>K.matches(j)))return[K];const $=this.getBranches(K,J),Q=K.getBoundingClientRect();if($.length<=1)return[K];const X=(await Promise.all($.map(async(j)=>{const Z=j.top.getBoundingClientRect();if(Z.width/Q.width<C&&Z.height/Q.height<C)return[];if(j.children.length===0)return[j.top];return await this.compareTopWithChildren(j.top,j.children)}))).flat();if(X.length>p)return X;return[K,...X]}getBranches(K,J){const $=this.getFirstHitChildren(K,J);return $.map((Q)=>{const W=J.filter((X)=>!$.includes(X)&&Q.contains(X));return{top:Q,children:W}})}getFirstHitChildren(K,J){const $=K.querySelectorAll(":scope > *"),Q=Array.from($).filter((W)=>J.includes(W));if(Q.length>0)return Q;return Array.from($).flatMap((W)=>this.getFirstHitChildren(W,J))}getTopLevelElements(K){const J=[],$=[];for(let Q of K)if(!K.some((W)=>W!==Q&&W.contains(Q)))J.push(Q);else $.push(Q);return{top:J,others:$}}}var T=v;class k{filters={visibility:new N,nesting:new T};async loadElements(){const K=A.join(",");let J=Array.from(document.querySelectorAll(K));const $=this.shadowRoots();for(let z=0;z<$.length;z++)J=J.concat(Array.from($[z].querySelectorAll(K)));const Q=document.querySelectorAll("*");let W=[];for(let z=0;z<Q.length;z++)if(!Q[z].matches(K)&&window.getComputedStyle(Q[z]).cursor==="pointer")W.push(Q[z]);W=Array.from(W).filter((z,Y,V)=>V.indexOf(z)===Y).filter((z)=>!z.closest("svg")&&!J.some((Y)=>Y.contains(z)));const X=await this.filters.visibility.apply(J),j=await this.filters.visibility.apply(W),Z=await this.filters.nesting.apply(j.concat(X));return X.concat(Z).filter((z,Y,V)=>V.indexOf(z)===Y)}shadowRoots(){const K=[],J=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode(Q){return NodeFilter.FILTER_ACCEPT}});let $;while($=J.nextNode())if($&&$.shadowRoot)K.push($.shadowRoot);return K}}class O{contrastColor(K,J){const $=window.getComputedStyle(K),Q=G.fromCSS($.backgroundColor);return this.getBestContrastColor([Q,...J])}getBestContrastColor(K){const J=K.filter((Q)=>Q.a>0).map((Q)=>Q.complimentary());let $;if(J.length===0)$=new G(Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255));else $=this.getAverageColor(J);if($.luminance()>S)$=$.withLuminance(S);else if($.luminance()<_)$=$.withLuminance(_);if($.saturation()<L)$=$.withSaturation(L);return $}getAverageColor(K){const J=K.reduce((W,X)=>W+X.r,0)/K.length,$=K.reduce((W,X)=>W+X.g,0)/K.length,Q=K.reduce((W,X)=>W+X.b,0)/K.length;return new G(J,$,Q)}}class G{K;J;$;Q;constructor(K,J,$,Q=255){this.r=K;this.g=J;this.b=$;this.a=Q;if(K<0||K>255)throw new Error(`Invalid red value: ${K}`);if(J<0||J>255)throw new Error(`Invalid green value: ${J}`);if($<0||$>255)throw new Error(`Invalid blue value: ${$}`);if(Q<0||Q>255)throw new Error(`Invalid alpha value: ${Q}`);this.r=Math.round(K),this.g=Math.round(J),this.b=Math.round($),this.a=Math.round(Q)}static fromCSS(K){if(K.startsWith("#"))return G.fromHex(K);if(K.startsWith("rgb")){const $=K.replace(/rgba?\(/,"").replace(")","").split(",").map((Q)=>parseInt(Q.trim()));return new G(...$)}if(K.startsWith("hsl")){const $=K.replace(/hsla?\(/,"").replace(")","").split(",").map((Q)=>parseFloat(Q.trim()));return G.fromHSL({h:$[0],s:$[1],l:$[2]})}const J=x[K.toLowerCase()];if(J)return G.fromHex(J);throw new Error(`Unknown color format: ${K}`)}static fromHex(K){if(K=K.replace("#",""),K.length===3)K=K.split("").map((W)=>W+W).join("");const J=parseInt(K.substring(0,2),16),$=parseInt(K.substring(2,4),16),Q=parseInt(K.substring(4,6),16);if(K.length===8){const W=parseInt(K.substring(6,8),16);return new G(J,$,Q,W)}return new G(J,$,Q)}static fromHSL(K){const{h:J,s:$,l:Q}=K;let W,X,j;if($===0)W=X=j=Q;else{const Z=(V,D,w)=>{if(w<0)w+=1;if(w>1)w-=1;if(w<0.16666666666666666)return V+(D-V)*6*w;if(w<0.5)return D;if(w<0.6666666666666666)return V+(D-V)*(0.6666666666666666-w)*6;return V},z=Q<0.5?Q*(1+$):Q+$-Q*$,Y=2*Q-z;W=Z(Y,z,J+0.3333333333333333),X=Z(Y,z,J),j=Z(Y,z,J-0.3333333333333333)}return new G(W*255,X*255,j*255)}luminance(){const K=this.r/255,J=this.g/255,$=this.b/255,Q=[K,J,$].map((W)=>{if(W<=0.03928)return W/12.92;return Math.pow((W+0.055)/1.055,2.4)});return 0.2126*Q[0]+0.7152*Q[1]+0.0722*Q[2]}withLuminance(K){const J=this.luminance(),$=K/J,Q=Math.min(255,this.r*$),W=Math.min(255,this.g*$),X=Math.min(255,this.b*$);return new G(Q,W,X,this.a)}saturation(){return this.toHsl().s}withSaturation(K){const J=this.toHsl();return J.s=K,G.fromHSL(J)}contrast(K){const J=this.luminance(),$=K.luminance();return(Math.max(J,$)+0.05)/(Math.min(J,$)+0.05)}complimentary(){const K=this.toHsl();return K.h=(K.h+0.5)%1,G.fromHSL(K)}toHex(){const K=this.r.toString(16).padStart(2,"0"),J=this.g.toString(16).padStart(2,"0"),$=this.b.toString(16).padStart(2,"0");if(this.a<255){const Q=this.a.toString(16).padStart(2,"0");return`#${K}${J}${$}${Q}`}return`#${K}${J}${$}`}toHsl(){const K=this.r/255,J=this.g/255,$=this.b/255,Q=Math.max(K,J,$),W=Math.min(K,J,$);let X=(Q+W)/2,j=(Q+W)/2,Z=(Q+W)/2;if(Q===W)X=j=0;else{const z=Q-W;switch(j=Z>0.5?z/(2-Q-W):z/(Q+W),Q){case K:X=(J-$)/z+(J<$?6:0);break;case J:X=($-K)/z+2;break;case $:X=(K-J)/z+4;break}X/=6}return{h:X,s:j,l:Z,a:this.a/255}}toString(){return this.toHex()}}var x={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};class H{colors=new O;display(K){const J=[],$=[],Q=[];for(let W=0;W<K.length;W++){const X=K[W],j=X.getBoundingClientRect(),Z=document.createElement("div");if(Z.style.left=`${j.left}px`,Z.style.top=`${j.top}px`,Z.style.width=`${j.width}px`,Z.style.height=`${j.height}px`,Z.classList.add("SoM"),X.isContentEditable||y.some((V)=>X.matches(V)))Z.classList.add("editable");const z=$.filter((V)=>{return[Math.sqrt(Math.pow(j.left-V.left,2)+Math.pow(j.top-V.top,2)),Math.sqrt(Math.pow(j.right-V.right,2)+Math.pow(j.top-V.top,2)),Math.sqrt(Math.pow(j.left-V.left,2)+Math.pow(j.bottom-V.bottom,2)),Math.sqrt(Math.pow(j.right-V.right,2)+Math.pow(j.bottom-V.bottom,2))].some((w)=>w<u)}).map((V)=>V.color);console.groupCollapsed(`Element: ${X.tagName} (${W})`);const Y=this.colors.contrastColor(X,z);Z.style.setProperty("--SoM-color",`${Y.r}, ${Y.g}, ${Y.b}`),document.body.appendChild(Z),$.push({top:j.top,bottom:j.bottom,left:j.left,right:j.right,width:j.width,height:j.height,color:Y}),Q.push(Z)}for(let W=0;W<K.length;W++){const X=K[W],j=$[W],Z=document.createElement("label");Z.textContent=`${W}`,Z.style.color=this.getColorByLuminance(j.color),Q[W].appendChild(Z);const z=Z.getBoundingClientRect(),Y=10,V=[];for(let F=0;F<=Y;F++)V.push({top:j.top-z.height,left:j.left+j.width/Y*F-z.width/2}),V.push({top:j.bottom,left:j.left+j.width/Y*F-z.width/2}),V.push({top:j.top+j.height/Y*F-z.height/2,left:j.left-z.width}),V.push({top:j.top+j.height/Y*F-z.height/2,left:j.right});const D=V.map((F)=>{let U=0;if(F.top<0||F.top+z.height>window.innerHeight||F.left<0||F.left+z.width>window.innerWidth)U+=Infinity;else J.concat($).forEach((B)=>{if(B.top<=j.top&&B.bottom>=j.bottom&&B.left<=j.left&&B.right>=j.right)return;const f=Math.max(0,Math.min(F.left+z.width,B.left+B.width)-Math.max(F.left,B.left)),R=Math.max(0,Math.min(F.top+z.height,B.top+B.height)-Math.max(F.top,B.top));U+=f*R});return U}),w=V[D.indexOf(Math.min(...D))];Z.style.top=`${w.top-j.top}px`,Z.style.left=`${w.left-j.left}px`,J.push({top:w.top,left:w.left,right:w.left+z.width,bottom:w.top+z.height,width:z.width,height:z.height}),X.setAttribute("data-SoM",`${W}`)}}getColorByLuminance(K){return K.luminance()>0.5?"black":"white"}}var E=".SoM{position:fixed;z-index:2147483646;pointer-events:none;background-color:rgba(var(--SoM-color),.45)}.SoM.editable{background:repeating-linear-gradient(45deg,rgba(var(--SoM-color),.15),rgba(var(--SoM-color),.15) 10px,rgba(var(--SoM-color),.45) 10px,rgba(var(--SoM-color),.45) 20px);outline:2px solid rgba(var(--SoM-color),.7)}.SoM>label{position:absolute;padding:0 3px;font-size:1rem;font-weight:700;line-height:1.2rem;white-space:nowrap;font-family:\"Courier New\",Courier,monospace;background-color:rgba(var(--SoM-color),.7)}";class g{loader=new k;ui=new H;async display(){this.log("Displaying...");const K=performance.now(),J=await this.loader.loadElements();this.clear(),this.ui.display(J),this.log("Done!",`Took ${performance.now()-K}ms to display ${J.length} elements.`)}clear(){document.querySelectorAll(".SoM").forEach((K)=>{K.remove()}),document.querySelectorAll("[data-som]").forEach((K)=>{K.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((K)=>K.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((K)=>K.style.display="block")}resolve(K){return document.querySelector(`[data-som="${K}"]`)}log(...K){console.log("%cSoM","color: white; background: #007bff; padding: 2px 5px; border-radius: 5px;",...K)}}if(!document.getElementById("SoM-styles")){const K=document.createElement("style");K.id="SoM-styles",K.innerHTML=E;const J=setInterval(()=>{if(document.head)clearInterval(J),document.head.appendChild(K)},100)}window.SoM=new g;window.SoM.log("Ready!");
