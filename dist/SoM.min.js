var A=["a[href]:not(:has(img))","a[href] img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],V=0.6,k=0.1;async function z(w){return(await Promise.all(w.map(async($)=>{if($.offsetWidth===0&&$.offsetHeight===0)return null;const H=$.id==="company-name",Q=window.getComputedStyle($);if(Q.display==="none"||Q.visibility==="hidden"||Q.pointerEvents==="none")return null;let q=$.parentElement,U=!0;while(q!==null){const D=window.getComputedStyle(q);if(D.display==="none"||D.visibility==="hidden"||D.pointerEvents==="none"){U=!1;break}q=q.parentElement}if(!U)return null;const y=$.getBoundingClientRect();if(y.top>=window.innerHeight||y.bottom<=0||y.left>=window.innerWidth||y.right<=0)return null;if(!await I($))return null;return $}))).filter(($)=>$!==null)}async function I(w){return new Promise((M)=>{const $=new IntersectionObserver(async(H)=>{const Q=H[0];if($.disconnect(),Q.intersectionRatio<V){M(!1);return}const q=w.getBoundingClientRect();if(q.width<=1||q.height<=1){M(!1);return}if(q.width>=window.innerWidth*0.8||q.height>=window.innerHeight*0.8){M(!1);return}const U=await u(w,q);M(U>=V)});$.observe(w)})}async function u(w,M){const $=document.createElement("canvas"),H=$.getContext("2d",{willReadFrequently:!0});if(!H)throw new Error("Could not get 2D context");const Q=parseInt(window.getComputedStyle(w).zIndex||"0",10);$.width=M.width,$.height=M.height,H.fillStyle="black",H.fillRect(0,0,$.width,$.height);const q={top:Math.max(0,M.top),left:Math.max(0,M.left),bottom:Math.min(window.innerHeight,M.bottom),right:Math.min(window.innerWidth,M.right)},U={width:q.right-q.left,height:q.bottom-q.top},y=()=>{const K=H.getImageData(q.left-M.left,q.top-M.top,U.width,U.height).data;let j=0;for(let W=0;W<K.length;W+=4)if(K[W]>0)j++;return j};B(w,H,M,M,"white");const J=y(),D=await Promise.all(Array.from({length:Math.ceil(1/k)}).map(async(K,j)=>{const W=document.elementsFromPoint(M.left+M.width*k*j,M.top+M.height*k*j);if(!W.includes(w))return[];const Z=W.indexOf(w);return W.slice(0,Z)})),F=Array.from(new Set(D.flat().filter((K)=>K!==w)));let X=[];for(let K of F){if(parseInt(window.getComputedStyle(K).zIndex||"0",10)<Q)continue;if(K.contains(w)||w.contains(K))continue;X.push(K)}X=X.filter((K)=>{for(let j of X)if(K!==j&&j.contains(K))return!1;return!0}),await Promise.all(X.map(async(K)=>{const j=K.getBoundingClientRect();B(K,H,j,M,"black")}));const Y=y();if($.remove(),J===0||Y===0)return 0;return Y/J}var B=function(w,M,$,H,Q="black"){const q=new Path2D,U=window.getComputedStyle(w),y=U.borderRadius?.split(" ").map((F)=>parseFloat(F)),J=U.clipPath,D={top:Math.max($.top-H.top,0),bottom:Math.min($.bottom-H.top,H.height),left:Math.max($.left-H.left,0),right:Math.min($.right-H.left,H.width),width:Math.min($.right-H.left,H.width)-Math.max($.left-H.left,0),height:Math.min($.bottom-H.top,H.height)-Math.max($.top-H.top,0)};if(y){if(y.length===1)y[1]=y[0];if(y.length===2)y[2]=y[0];if(y.length===3)y[3]=y[1];q.moveTo(D.left+y[0],D.top),q.arcTo(D.right,D.top,D.right,D.bottom,y[1]),q.arcTo(D.right,D.bottom,D.left,D.bottom,y[2]),q.arcTo(D.left,D.bottom,D.left,D.top,y[3]),q.arcTo(D.left,D.top,D.right,D.top,y[0])}else q.rect(D.left,D.top,D.width,D.height);if(J&&J!=="none"){const F=new Path2D(J);q.addPath(F)}M.fillStyle=Q,M.fill(q)};function G(w){const M=[],$=[];for(let H of w)if(!w.some((Q)=>Q!==H&&Q.contains(H)))M.push(H);else $.push(H);return M.flatMap((H)=>N(H,$))}var N=function(w,M){const $=C(w,M);if($.length<=1)return[w];return $.flatMap((H)=>{if(H.directChild)return N(H.directChild,M);return G(H.children)})},C=function(w,M){const $=w.querySelectorAll(":scope > *");return Array.from($).map((H)=>{const Q=M.filter((U)=>U!==H&&H.contains(U));return{directChild:M.includes(H)?H:void 0,children:Q}})};async function O(){const w=document.querySelectorAll(A.join(",")),M=document.querySelectorAll("*"),$=[];for(let q=0;q<M.length;q++)if(window.getComputedStyle(M[q]).cursor==="pointer")$.push(M[q]);const H=Array.from(w).concat($).filter((q,U,y)=>y.indexOf(q)===U).filter((q)=>!q.closest("svg")),Q=await z(H);return await G(Q)}function S(w){const M=[],$=[],H=[],Q=()=>Math.floor(Math.random()*256);for(let q=0;q<w.length;q++){const y=w[q].getBoundingClientRect(),J=document.createElement("div");J.style.left=`${y.left}px`,J.style.top=`${y.top}px`,J.style.width=`${y.width}px`,J.style.height=`${y.height}px`,J.classList.add("SoM");const D=[Q(),Q(),Q()];J.style.backgroundColor=`rgba(${D.join(",")}, 0.5)`,document.body.appendChild(J),$.push({top:y.top,bottom:y.bottom,left:y.left,right:y.right,width:y.width,height:y.height,color:D}),H.push(J)}for(let q=0;q<w.length;q++){const U=w[q],y=$[q],J=document.createElement("label");J.textContent=`${q}`,J.style.color=g(y.color),J.style.backgroundColor=`rgba(${y.color.join(",")}, 0.7)`,H[q].appendChild(J);const D=J.getBoundingClientRect(),F=10,X=[];for(let j=0;j<=F;j++)X.push({top:y.top-D.height,left:y.left+y.width/F*j-D.width/2}),X.push({top:y.bottom,left:y.left+y.width/F*j-D.width/2}),X.push({top:y.top+y.height/F*j-D.height/2,left:y.left-D.width}),X.push({top:y.top+y.height/F*j-D.height/2,left:y.right});const Y=X.map((j)=>{let W=0;if(j.top<0||j.top+D.height>window.innerHeight||j.left<0||j.left+D.width>window.innerWidth)W+=Infinity;else M.concat($).forEach((Z)=>{const L=Math.max(0,Math.min(j.left+D.width,Z.left+Z.width)-Math.max(j.left,Z.left)),T=Math.max(0,Math.min(j.top+D.height,Z.top+Z.height)-Math.max(j.top,Z.top));W+=L*T});return W}),K=X[Y.indexOf(Math.min(...Y))];J.style.top=`${K.top-y.top}px`,J.style.left=`${K.left-y.left}px`,M.push({top:K.top,left:K.left,right:K.left+D.width,bottom:K.top+D.height,width:D.width,height:D.height}),U.setAttribute("data-SoM",`${q}`)}}var g=function(w){const[M,$,H]=w.map((q)=>q/255);return 0.299*M+0.587*$+0.114*H>0.5?"black":"white"};class _{async display(){this.log("Displaying...");const w=performance.now();this.clear();const M=await O();S(M),this.log("Done!",`Took ${performance.now()-w}ms to display ${M.length} elements.`)}clear(){document.querySelectorAll(".SoM").forEach((w)=>{w.remove()}),document.querySelectorAll("[data-som]").forEach((w)=>{w.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="none")}show(){document.querySelectorAll(".SoM").forEach((w)=>w.style.display="block")}resolve(w){return document.querySelector(`[data-som="${w}"]`)}log(...w){console.log("%cSoM","color: white; background: #007bff; padding: 2px 5px; border-radius: 5px;",...w)}}window.SoM=new _;window.SoM.log("Ready!");
