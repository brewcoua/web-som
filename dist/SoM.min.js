var H=["a:not(:has(img))","a img","button",'input:not([type="hidden"])',"select","textarea",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]',".btn",'[role="button"]','[role="link"]','[role="checkbox"]','[role="radio"]','[role="input"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="switch"]','[role="tab"]','[role="treeitem"]','[role="gridcell"]','[role="search"]','[role="combobox"]','[role="listbox"]','[role="slider"]','[role="spinbutton"]'],u=0.6,Y=0.1;class B{}class S extends B{constructor(){super(...arguments)}async apply($){return(await Promise.all($.map(async(M)=>{if(M.offsetWidth===0&&M.offsetHeight===0)return null;const K=window.getComputedStyle(M);if(K.display==="none"||K.visibility==="hidden"||K.pointerEvents==="none")return null;let X=M.parentElement,U=!0;while(X!==null){const J=window.getComputedStyle(X);if(J.display==="none"||J.visibility==="hidden"||J.pointerEvents==="none"){U=!1;break}X=X.parentElement}if(!U)return null;if(!await this.isElementVisible(M))return null;return M}))).filter((M)=>M!==null)}async isElementVisible($){return new Promise((q)=>{const M=new IntersectionObserver(async(K)=>{const X=K[0];if(M.disconnect(),X.intersectionRatio<u){q(!1);return}const U=$.getBoundingClientRect();if(U.width<=1||U.height<=1){q(!1);return}if(U.width>=window.innerWidth*0.8||U.height>=window.innerHeight*0.8){q(!1);return}const W=await this.getVisibilityRatio($,U);q(W>=u)});M.observe($)})}async getVisibilityRatio($,q){const M=document.createElement("canvas"),K=M.getContext("2d",{willReadFrequently:!0});if(!K)throw new Error("Could not get 2D context");const X=parseInt(window.getComputedStyle($).zIndex||"0",10);M.width=q.width,M.height=q.height,K.fillStyle="black",K.fillRect(0,0,M.width,M.height);const U={top:Math.max(0,q.top),left:Math.max(0,q.left),bottom:Math.min(window.innerHeight,q.bottom),right:Math.min(window.innerWidth,q.right),width:q.width,height:q.height};U.width=U.right-U.left,U.height=U.bottom-U.top,this.drawElement($,K,q,q,"white");const W=this.countVisiblePixels(K,{top:U.top-q.top,left:U.left-q.left,width:M.width,height:M.height}),J=await Promise.all(Array.from({length:Math.ceil(1/Y)}).map(async(j,y)=>{return Promise.all(Array.from({length:Math.ceil(1/Y)}).map(async(z,D)=>{const G=document.elementsFromPoint(q.left+q.width*Y*y,q.top+q.height*Y*D);if(!G.includes($))return[];const V=G.indexOf($);return G.slice(0,V)}))})),w=Array.from(new Set(J.flat(2).filter((j)=>j!==$)));let Q=[];for(let j of w){if(parseInt(window.getComputedStyle(j).zIndex||"0",10)<X)continue;if(j.contains($)||$.contains(j))continue;Q.push(j)}Q=Q.filter((j)=>{for(let y of Q)if(j!==y&&y.contains(j))return!1;return!0}),await Promise.all(Q.map(async(j)=>{const y=j.getBoundingClientRect();this.drawElement(j,K,y,q,"black")}));const Z=this.countVisiblePixels(K,{top:U.top-q.top,left:U.left-q.left,width:U.width,height:U.height});if(M.remove(),W===0)return 0;return Z/W}countVisiblePixels($,q){const M=$.getImageData(q.left,q.top,q.width,q.height).data;let K=0;for(let X=0;X<M.length;X+=4)if(M[X]>0)K++;return K}drawElement($,q,M,K,X="black"){const U=window.getComputedStyle($),W=U.borderRadius?.split(" ").map((Q)=>parseFloat(Q)),J=U.clipPath,w={top:M.top-K.top,bottom:M.bottom-K.top,left:M.left-K.left,right:M.right-K.left,width:M.width,height:M.height};if(w.width=w.right-w.left,w.height=w.bottom-w.top,q.fillStyle=X,J&&J!=="none")J.split(/,| /).forEach((Z)=>{const j=Z.trim().match(/^([a-z]+)\((.*)\)$/);if(!j)return;switch(j[0]){case"polygon":const y=this.pathFromPolygon(Z,M);q.fill(y);break;default:console.log("Unknown clip path kind: "+j)}});else if(W){const Q=new Path2D;if(W.length===1)W[1]=W[0];if(W.length===2)W[2]=W[0];if(W.length===3)W[3]=W[1];Q.moveTo(w.left+W[0],w.top),Q.arcTo(w.right,w.top,w.right,w.bottom,W[1]),Q.arcTo(w.right,w.bottom,w.left,w.bottom,W[2]),Q.arcTo(w.left,w.bottom,w.left,w.top,W[3]),Q.arcTo(w.left,w.top,w.right,w.top,W[0]),Q.closePath(),q.fill(Q)}else q.fillRect(w.left,w.top,w.width,w.height)}pathFromPolygon($,q){if(!$||!$.match(/^polygon\((.*)\)$/))throw new Error("Invalid polygon format: "+$);const M=new Path2D,K=$.match(/\d+(\.\d+)?%/g);if(K&&K.length>=2){const X=parseFloat(K[0]),U=parseFloat(K[1]);M.moveTo(X*q.width/100,U*q.height/100);for(let W=2;W<K.length;W+=2){const J=parseFloat(K[W]),w=parseFloat(K[W+1]);M.lineTo(J*q.width/100,w*q.height/100)}M.closePath()}return M}}var A=S;var k=0.9,I=3,P=["a","button","input","select","textarea"];class N extends B{constructor(){super(...arguments)}async apply($){const{top:q,others:M}=this.getTopLevelElements($);return(await Promise.all(q.map(async(X)=>this.compareTopWithChildren(X,M)))).flat()}async compareTopWithChildren($,q){if(P.some((W)=>$.matches(W)))return[$];const M=this.getBranches($,q),K=$.getBoundingClientRect();if(M.length<=1)return[$];const U=(await Promise.all(M.map(async(W)=>{const J=W.top.getBoundingClientRect();if(J.width/K.width<k&&J.height/K.height<k)return[];if(W.children.length===0)return[W.top];return await this.compareTopWithChildren(W.top,W.children)}))).flat();if(U.length>I)return U;return[$,...U]}getBranches($,q){const M=this.getFirstHitChildren($,q);return M.map((K)=>{const X=q.filter((U)=>!M.includes(U)&&K.contains(U));return{top:K,children:X}})}getFirstHitChildren($,q){const M=$.querySelectorAll(":scope > *"),K=Array.from(M).filter((X)=>q.includes(X));if(K.length>0)return K;return Array.from(M).flatMap((X)=>this.getFirstHitChildren(X,q))}getTopLevelElements($){const q=[],M=[];for(let K of $)if(!$.some((X)=>X!==K&&X.contains(K)))q.push(K);else M.push(K);return{top:q,others:M}}}var C=N;class F{filters={visibility:new A,nesting:new C};async loadElements(){const $=H.join(",");let q=Array.from(document.querySelectorAll($));const M=this.shadowRoots();for(let w=0;w<M.length;w++)q=q.concat(Array.from(M[w].querySelectorAll($)));const K=document.querySelectorAll("*");let X=[];for(let w=0;w<K.length;w++)if(!K[w].matches($)&&window.getComputedStyle(K[w]).cursor==="pointer")X.push(K[w]);X=Array.from(X).filter((w,Q,Z)=>Z.indexOf(w)===Q).filter((w)=>!w.closest("svg")&&!q.some((Q)=>Q.contains(w)));const U=await this.filters.visibility.apply(q),W=await this.filters.visibility.apply(X),J=await this.filters.nesting.apply(W.concat(U));return U.concat(J).filter((w,Q,Z)=>Z.indexOf(w)===Q)}shadowRoots(){const $=[],q=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode(K){return NodeFilter.FILTER_ACCEPT}});let M;while(M=q.nextNode())if(M&&M.shadowRoot)$.push(M.shadowRoot);return $}}class O{display($){const q=[],M=[],K=[],X=()=>Math.floor(Math.random()*256);for(let U=0;U<$.length;U++){const J=$[U].getBoundingClientRect(),w=document.createElement("div");w.style.left=`${J.left}px`,w.style.top=`${J.top}px`,w.style.width=`${J.width}px`,w.style.height=`${J.height}px`,w.classList.add("SoM");const Q=[X(),X(),X()];w.style.backgroundColor=`rgba(${Q.join(",")}, 0.3)`,document.body.appendChild(w),M.push({top:J.top,bottom:J.bottom,left:J.left,right:J.right,width:J.width,height:J.height,color:Q}),K.push(w)}for(let U=0;U<$.length;U++){const W=$[U],J=M[U],w=document.createElement("label");w.textContent=`${U}`,w.style.color=this.colorFromLuminance(J.color),w.style.backgroundColor=`rgba(${J.color.join(",")}, 0.5)`,K[U].appendChild(w);const Q=w.getBoundingClientRect(),Z=10,j=[];for(let D=0;D<=Z;D++)j.push({top:J.top-Q.height,left:J.left+J.width/Z*D-Q.width/2}),j.push({top:J.bottom,left:J.left+J.width/Z*D-Q.width/2}),j.push({top:J.top+J.height/Z*D-Q.height/2,left:J.left-Q.width}),j.push({top:J.top+J.height/Z*D-Q.height/2,left:J.right});const y=j.map((D)=>{let G=0;if(D.top<0||D.top+Q.height>window.innerHeight||D.left<0||D.left+Q.width>window.innerWidth)G+=Infinity;else q.concat(M).forEach((V)=>{const _=Math.max(0,Math.min(D.left+Q.width,V.left+V.width)-Math.max(D.left,V.left)),T=Math.max(0,Math.min(D.top+Q.height,V.top+V.height)-Math.max(D.top,V.top));G+=_*T});return G}),z=j[y.indexOf(Math.min(...y))];w.style.top=`${z.top-J.top}px`,w.style.left=`${z.left-J.left}px`,q.push({top:z.top,left:z.left,right:z.left+Q.width,bottom:z.top+Q.height,width:Q.width,height:Q.height}),W.setAttribute("data-SoM",`${U}`)}}colorFromLuminance($){const[q,M,K]=$.map((U)=>U/255);return 0.299*q+0.587*M+0.114*K>0.5?"black":"white"}}class L{loader=new F;ui=new O;async display(){this.log("Displaying...");const $=performance.now(),q=await this.loader.loadElements();this.clear(),this.ui.display(q),this.log("Done!",`Took ${performance.now()-$}ms to display ${q.length} elements.`)}clear(){document.querySelectorAll(".SoM").forEach(($)=>{$.remove()}),document.querySelectorAll("[data-som]").forEach(($)=>{$.removeAttribute("data-som")})}hide(){document.querySelectorAll(".SoM").forEach(($)=>$.style.display="none")}show(){document.querySelectorAll(".SoM").forEach(($)=>$.style.display="block")}resolve($){return document.querySelector(`[data-som="${$}"]`)}log(...$){console.log("%cSoM","color: white; background: #007bff; padding: 2px 5px; border-radius: 5px;",...$)}}window.SoM=new L;window.SoM.log("Ready!");
